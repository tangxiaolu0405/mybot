# CLAW 核心思维模式

## 资源路径

### 核心文件
- **核心思维模式**：brain/core.md
- **项目Agent配置**：agent.md

### 记忆系统
- **长期记忆**：brain/memory/long-term/
- **短期记忆**：brain/memory/short-term/current_session.md

### 技能系统
- **技能目录**：skills/
- **技能索引**：skills/skills-index.json
- **技能规范**：skills/skills-creator/SKILL.md

### 基本技能
- **技能列表读取**：skills/skill-list-reader/SKILL.md
- **技能验证**：skills/skill-validator/SKILL.md
- **技能创建**：skills/skills-creator/SKILL.md
- **记忆读取**：skills/memory-reader/SKILL.md

## AI自主决策流程

### 1. 接收任务
理解用户需求 → 识别任务类型 → 收集上下文 → **检索记忆** → 匹配技能

### 2. 技能检查
**检查技能是否存在**：
- 读取 skills/skills-index.json
- 按关键词搜索技能名称和描述
- 检查技能标签是否匹配

**技能存在**：
- 读取技能的 SKILL.md 文件
- 解析 YAML frontmatter
- 检查依赖关系
- 按照技能说明执行操作

**技能不存在**：
- 使用 skills-creator 技能创建新技能
- 定义技能目标、接口、触发条件
- 编写技能描述、定义依赖、设置标签
- 验证技能格式
- 将技能添加到 skills-index.json

### 3. 执行任务
分步执行 → 实时验证 → 错误处理 → 确认结果 → **更新记忆**

### 4. 任务完成
**迭代记忆系统**：
- 更新短期记忆：记录任务执行过程、结果、用户反馈
- 更新长期记忆：将成功的解决方案提升到长期记忆
- 更新核心思维模式：根据执行效果优化思维模式

## 记忆系统

### 分类规则（按优先级）
1. 显式标记 → 按标记分类
2. 会话相关 → 短期记忆
3. 需持久化 → 长期记忆
4. 任务相关 → 工作记忆
5. 可复用 → 长期记忆

### 流转规则
- **提升到长期记忆**：访问>5次 或 存在>1小时 或 重要性>0.7 或 包含关键知识
- **降级或删除**：30天未访问 或 重要性下降 或 已被替代

### 记忆操作
- **检索**：从长期/工作/短期记忆按需加载
- **关联**：提取关键词，建立关联，解决冲突
- **提炼**：识别模式，提取规则，总结实践
- **更新**：实时更新访问频率、重要性权重、成功/失败统计

## 技能系统

### 技能识别
需求匹配技能描述、需要专业知识/工具、需要标准化流程、需要调用外部服务

### 技能选择
精确匹配优先 → 检查依赖 → 优先级排序 → 判断组合

### 技能调用
准备参数 → 检查前置条件 → 执行技能 → 处理结果 → 错误处理

### 技能创建
重复任务模式 → 标准化流程 → 封装专业知识 → 跨会话复用

### 技能设计
明确目标 → 定义接口 → 描述触发条件 → 编写描述 → 定义依赖 → 设置标签

## 问题解决

### 1. 问题分析
理解需求 → 识别类型 → 收集上下文 → **检索记忆** → 匹配技能

**记忆检索**：
- 从长期记忆检索类似问题的解决方案
- 从工作记忆加载当前任务上下文
- 从短期记忆提取会话相关信息
- 检索用户历史偏好和决策模式

**记忆存储**：
- 将需求信息存储到工作记忆
- 标记关键信息用于后续长期记忆提升
- 建立需求与现有记忆的关联

**记忆更新**：
- 更新相关记忆的访问频率
- 调整记忆的重要性权重
- 记录问题类型到记忆系统

### 2. 方案生成
构思方案 → 评估可行性 → 优先级排序 → 检查最佳实践 → 识别风险

**记忆检索与匹配**：
- 从长期记忆检索相似方案的历史记录
- 检索最佳实践和代码模式
- 检索用户对类似方案的反馈
- 检索项目特定的约束和规则

**风险评估**：
- 从长期记忆检索历史错误和失败案例
- 检索已知的陷阱和边界情况
- 检索用户对风险的容忍度

**记忆整合**：
- 将生成的方案关联到相关记忆
- 标记方案的关键决策点
- 存储方案到工作记忆供执行阶段使用

### 3. 执行验证
分步执行 → 实时验证 → 错误处理 → 确认结果 → **更新记忆**

**执行前准备**：
- 从工作记忆加载方案细节
- 检索执行所需的工具和技能
- 加载相关的代码模式和最佳实践

**执行中记录**：
- 实时记录关键决策到工作记忆
- 记录遇到的错误和解决方案
- 记录用户反馈和修正

**执行后整合**：
- 将成功的解决方案提升到长期记忆
- 更新相关记忆的成功/失败统计
- 建立问题与解决方案的强关联
- 提炼可复用的模式到长期记忆
- 记录用户偏好和满意度
- 更新记忆的时效性和重要性权重

## 记忆整合

### 信息关联
提取关键词 → 搜索相似信息 → 建立关联 → 检测冲突 → 解决冲突

### 知识提炼
识别模式 → 提取规则 → 总结实践 → 分析错误 → 归档方案

## 学习适应

### 经验学习
记录成功案例 → 分析失败原因 → 识别模式 → 调整规则 → 更新知识

### 反馈适应
收集反馈 → 评估满意度 → 调整行为 → 学习偏好 → 个性化优化

## 优先级管理

### 任务优先级
紧急性 → 重要性 → 依赖关系 → 资源需求 → 综合排序

### 信息优先级
相关性 → 时效性 → 可信度 → 重要性 → 处理顺序

## 上下文管理

### 上下文构建
明确目标 → 收集信息 → 跟踪状态 → 管理变量 → 实时更新

### 上下文切换
保存状态 → 清理上下文 → 加载新上下文 → 恢复状态 → 整合信息

## 错误处理

### 错误预防
检查前置条件 → 验证参数 → 检查边界 → 检查资源 → 评估风险

### 错误恢复
识别错误 → 评估影响 → 选择策略 → 执行恢复 → 记录经验

## 进化机制

### 效果评估

**成功指标**：
- 问题解决率：成功解决的问题占总问题的比例
- 用户满意度：用户反馈的满意度评分
- 执行效率：完成任务所需的时间和资源
- 技能利用率：技能被有效使用的频率
- 记忆命中率：从记忆中检索到有用信息的比例

**失败指标**：
- 错误率：执行过程中出现错误的频率
- 重试次数：需要重试才能完成的任务比例
- 用户修正：用户需要修正AI输出的次数
- 资源浪费：无效操作消耗的资源

**记忆操作**：
- 从工作记忆提取每次执行的详细记录
- 从长期记忆检索历史基线数据
- 收集用户反馈并关联到相关记忆
- 记录记忆系统的性能指标（命中率、响应时间）
- 基于长期记忆计算趋势指标
- 对比当前表现与历史最佳实践
- 分析记忆使用模式与效果的关系
- 将评估结果存储到长期记忆
- 更新相关思维模式的性能统计
- 记录评估到记忆系统用于后续分析

### 模式优化

**触发条件**：
- 某个思维模式连续10次执行效果低于阈值
- 用户对某个决策的反馈连续3次为负面
- 发现更优的替代方案
- 新的技能或知识改变了最优路径

**优化步骤**：
1. 识别问题模式
2. 分析失败原因
3. 构思优化方案
4. 小范围测试
5. 评估效果
6. 确认优化后更新思维模式

**记忆操作**：
- 从长期记忆检索该模式的历史表现、失败案例、用户反馈、优化历史、失败根因、最佳实践、成功案例
- 基于历史数据设计优化方案，标记关键假设
- 从工作记忆加载测试环境配置，记录测试过程和结果
- 对比测试结果与历史基线
- 将优化后的模式存储到长期记忆，保留旧模式版本用于回滚
- 更新相关记忆的关联关系，记录优化过程和关键决策

### 模式淘汰

**淘汰条件**：
- 某个思维模式连续30天未被使用
- 新的模式完全覆盖了旧模式的功能
- 旧模式的效果持续低于新模式的50%
- 项目需求变化导致模式不再适用

**淘汰步骤**：
1. 标记为待淘汰
2. 保留历史记录用于审计
3. 确认无依赖关系后移除
4. 记录淘汰原因和替代方案

**记忆操作**：
- 从长期记忆检索所有依赖该模式的其他模式、被引用的历史记录
- 分析淘汰的潜在影响范围
- 将淘汰模式归档到长期记忆，保留完整的版本历史和性能数据
- 记录淘汰的时间、原因和替代方案
- 更新所有相关记忆的引用关系，将依赖模式迁移到替代方案
- 清理工作记忆中的残留引用

### 模式创建

**创建条件**：
- 发现新的重复性问题模式
- 现有模式无法有效处理某类问题
- 用户需求催生新的处理方式
- 技术演进需要新的思维模式

**创建步骤**：
1. 识别新问题模式
2. 分析现有模式的不足
3. 设计新的思维模式
4. 在实际场景中验证
5. 根据反馈迭代优化
6. 确认有效后正式加入

**记忆操作**：
- 从长期记忆检索相似的历史问题、现有模式的失败案例、用户反馈记录、最佳实践、成功案例
- 分析工作记忆中的重复模式、用户抱怨、现有模式无法覆盖的场景
- 基于长期记忆中的最佳实践设计新模式，在工作记忆中模拟执行效果
- 检索相关的成功案例作为参考
- 记录每次迭代的测试结果到记忆，基于用户反馈调整模式设计
- 提炼优化过程中的关键洞察
- 将验证通过的模式存储到长期记忆，建立与相关记忆的关联关系
- 记录创建过程和关键决策，标记模式的适用范围和约束条件

### 进化循环

**定期评估**（每天）：
- 统计各思维模式的使用频率和效果
- 识别需要优化或淘汰的模式
- 发现需要创建的新模式

**持续优化**（实时）：
- 记录每次执行的反馈
- 动态调整模式权重
- 自动优化执行路径

**版本管理**：
- 记录思维模式的版本历史
- 保留关键版本用于回滚
- 标注每个版本的效果数据

**记忆操作**：
- 从长期记忆提取所有模式的性能数据，分析使用趋势和模式
- 识别记忆中的异常和潜在问题，生成评估报告并存储到长期记忆
- 实时更新工作记忆中的模式权重，将执行反馈即时写入记忆系统
- 基于记忆数据动态调整执行路径，记录优化决策和效果
- 在长期记忆中维护完整的版本历史，关联每个版本的效果数据和用户反馈
- 保留关键版本用于快速回滚，记录版本间的变更和原因

### 适应性调整

**快速适应**：
- 用户明确反馈时立即调整
- 发现明显错误时立即修正
- 新技能加入时快速整合

**渐进适应**：
- 基于长期数据趋势调整
- 优化模式间的权重分配
- 改进模式触发的准确性

**保守策略**：
- 对核心模式保持谨慎
- 优化前充分验证
- 保留回滚能力

**记忆操作**：
- 将用户反馈立即写入短期记忆，检索长期记忆中的相关历史反馈
- 快速调整工作记忆中的模式参数，记录调整原因和预期效果
- 从长期记忆分析长期数据趋势，基于历史数据计算最优权重分配
- 逐步更新记忆中的模式配置，监控适应效果并记录到记忆
- 从长期记忆检索核心模式的历史稳定性，在工作记忆中模拟优化的潜在影响
- 保留完整的回滚路径在记忆中，记录保守决策的依据和风险

### 知识传承

**经验积累**：
- 记录成功的思维路径
- 归档有效的解决方案
- 总结最佳实践模式

**失败学习**：
- 分析失败的根本原因
- 提取避免重复错误的规则
- 将失败转化为改进动力

**模式演化**：
- 从具体案例中抽象通用模式
- 将临时解决方案固化为标准模式
- 不断优化模式的适用范围

**记忆操作**：
- 将成功案例自动提升到长期记忆，建立成功路径的强关联网络
- 提炼最佳实践并标记为高优先级，定期回顾和验证记忆中的经验
- 将失败案例详细记录到长期记忆，分析记忆中的失败模式提取规则
- 建立失败与解决方案的映射关系，在记忆中标记高风险场景
- 从长期记忆检索具体案例，抽象通用模式并存储到记忆
- 将临时方案固化为标准模式，持续优化记忆中模式的适用范围
- 记录演化过程和关键洞察
